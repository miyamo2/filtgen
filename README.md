# filtgen

CLI tool for generating iterators that selects items by their field values.

## Quick Start

### Install

```sh
go install github.com/miyamo2/filtgen@latest
```

### Usage

#### Step 1: Tag your struct with the `filtgen`

```go
//go:generate filtgen generate -s $GOFILE
package main

import (
	"time"
)

type Foo struct {
	StringField     string     `filtgen:"*"`
	IntField        int        `filtgen:"*"`
	BoolField       bool       `filtgen:"*"`
	TimeField       time.Time  `filtgen:"*"`
	ErrorField      error      `filtgen:"*"`
}
```

#### Step 2: Run `filtgen generate`

##### Run with `go generate`

```sh
go generate ./...
```

##### Run with `filtgen` command

```sh
filtgen generate -s your_struct.go
```

#### Step 3: Use generated iterator

```go
errSomething := errors.New("something")

s := []Foo{
    {StringField: "a", IntField: 1, BoolField: true, TimeField: time.Now()},
    {StringField: "b", IntField: 2, BoolField: false, TimeField: time.Now(), ErrorField: errSomething},
    {StringField: "c", IntField: 3, BoolField: true, TimeField: time.Now().Add(-(time.Hour * 2))},
}

for i, v := range FooSlice(s).StringFieldGe("a") {
    fmt.Printf("%d: %s\n", i, v.StringField)
}
// Output: 0: a
// 1: b
// 2: c

for i, v := range FooSlice(s).IntFieldGt(1) {
    fmt.Printf("%d: %s\n", i, v.StringField)
}
// Output: 1: b
// 2: c

for i, v := range FooSlice(s).BoolFieldEq(true) {
    fmt.Printf("%d: %s\n", i, v.StringField)
}
// Output: 0: a
// 2: c

for i, v := range FooSlice(s).TimeFieldMatches(func(t time.Time) bool { return t.Before(time.Now()) }) {
    fmt.Printf("%d: %s\n", i, v.StringField)
}
// Output: 2: c

for i, v := range FooSlice(s).ErrorFieldIs(errSomething) {
    fmt.Printf("%d: %s\n", i, v.StringField)
}
// Output: 1: b

// with method chaining
for i, v := range FooSlice(s).IntFieldGt(1).StringFieldNe("c") {
    fmt.Printf("%d: %s\n", i, v.StringField)
}
// Output: 1: b
```

For the actual generated code, see the [example](https://github.com/miyamo2/filtgen/tree/main/example).

## Features

Following methods are generated by `filtgen`.  
Method name is determined by the field name; e.g. `Name` -> `NameEq`.

### `XxxEq`

Selects iterator items whose field values are equal to the specified value.

### `XxxNe`

Selects iterator items whose field values are not equal to the specified value.

### `XxxGt`

Selects iterator items whose field values are greater than the specified value.

### `XxxLt`

Selects iterator items whose field values are less than the specified value.

### `XxxGe`

Selects iterator items whose field values are greater than or equal to the specified value.

### `XxxLe`

Selects iterator items whose field values are less than or equal to the specified value.

### `XxxMatches`

Selects iterator items whose field values match the specified function.

### `XxxIs`

Selects iterator items whose field values are equal to the specified `error`.  
Equivalence is determined by `errors.Is`.

### `XxxIsnt`

Selects iterator items whose field values are not equal to the specified `error`.
Equivalence is determined by `errors.Is`.

## List of compatible filters by type

| Type\Filter  | `XxxEq` | `XxxNe` | `XxxGt` | `XxxLt` | `XxxGe` | `XxxLe` | `XxxMatches` | `XxxIs` | `XxxIsnt` |
|--------------|---------|---------|---------|---------|---------|---------|--------------|---------|-----------|
| `string`     | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️           | ❌       | ❌         |
| `int`        | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️           | ❌       | ❌         |
| `int8`       | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️           | ❌       | ❌         |
| `int16`      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️           | ❌       | ❌         |
| `int32`      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️           | ❌       | ❌         |
| `int64`      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️           | ❌       | ❌         |
| `uint`       | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️           | ❌       | ❌         |
| `uint8`      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️           | ❌       | ❌         |
| `uint16`     | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️           | ❌       | ❌         |
| `uint32`     | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️           | ❌       | ❌         |
| `uint64`     | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️           | ❌       | ❌         |
| `float32`    | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️           | ❌       | ❌         |
| `float64`    | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️           | ❌       | ❌         |
| `complex64`  | ❌       | ❌       | ❌       | ❌       | ❌       | ❌       | ✔️           | ❌       | ❌         |
| `complex128` | ❌       | ❌       | ❌       | ❌       | ❌       | ❌       | ✔️           | ❌       | ❌         |
| `byte`       | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️           | ❌       | ❌         |
| `rune`       | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️      | ✔️           | ❌       | ❌         |
| `error`      | ❌       | ❌       | ❌       | ❌       | ❌       | ❌       | ✔️           | ✔️      | ✔️        |
| `bool`       | ✔️      | ✔️      | ❌       | ❌       | ❌       | ❌       | ✔️           | ❌       | ❌         |
| other-types  | ❌       | ❌       | ❌       | ❌       | ❌       | ❌       | ✔️           | ❌       | ❌         |

## `filtgen` tags

The following values can be set in the `filtgen` tag.  
If you want to set multiple values, separate them with `,`.

```go
type A struct {
    StringField string `filtgen:"eq,ne"`
}
```

| Value     | Description                                                         |
|-----------|---------------------------------------------------------------------|
| `*`       | Generate all methods supported according to the type of that field. |
| `eq`      | Generate `XxxEq` methods.                                           |
| `ne`      | Generate `XxxNe` methods.                                           |
| `gt`      | Generate `XxxGt` methods.                                           |
| `lt`      | Generate `XxxLt` methods.                                           |
| `ge`      | Generate `XxxGe` methods.                                           |
| `le`      | Generate `XxxLe` methods.                                           |
| `matches` | Generate `XxxMatches` methods.                                      |
| `is`      | Generate `XxxIs` methods.                                           |
| `isnt`    | Generate `XxxIsnt` methods.                                         |

## For Contributors

Feel free to open a PR or an Issue.  
However, you must promise to follow our [Code of Conduct](https://github.com/miyamo2/filtgen/blob/main/CODE_OF_CONDUCT.md).

### Tasks

We recommend that this section be run with [`xc`](https://github.com/joerdav/xc).

#### setup:deps

Install `golangci-lint`.

```sh
go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest
```

#### lint

```sh
golangci-lint run --fix
```

## License

**filtgen** released under the [MIT License](https://github.com/miyamo2/filtgen/blob/main/LICENSE)